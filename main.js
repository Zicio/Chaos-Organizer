(()=>{"use strict";class t{static start(e){const s=document.querySelector(".popup");s.classList.add("close"),s.addEventListener("transitionend",(()=>{s.style.display="none"})),t.showWelcome(e)}static showWelcome(e){const s=document.querySelector(".welcome"),n=s.querySelector("tspan"),o=document.querySelector(".chat");n.textContent=e,s.classList.add("start"),t.showChat(s,o)}static showChat(t,e){t.addEventListener("animationend",(()=>{t.classList.remove("start"),t.style.display="none",e.style.display="grid"}));const s=e.querySelector(".users__list"),n=document.createElement("li");n.classList.add("list__card","you"),n.textContent="âœ¯You",s.append(n)}static showMessages(e,s){const n=document.querySelector(".chat__tape");for(const o of e){const e=t.setEl("li","chat__message");n.appendChild(e);const a=t.setEl("span","message__info");document.querySelector(".you"),o.name===s?(a.textContent="You",a.dataset.myName=s):a.textContent=o.name;const i=t.setEl("span","message__text");i.textContent=`${o.date} ${o.text}`,e.appendChild(a),e.appendChild(i)}}static showHint(t){const e=document.querySelector(".form__hint");if(t)return e.textContent=t,void(e.style.display="block");e.style.display=null}static setEl(t,...e){const s=document.createElement(t);return s.classList.add(...e),s}}class e{constructor(){this.url=new URL("http://localhost:7000/"),this.ws=null}async post(t){const e=await fetch(`${this.url}login/`,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)});return e.ok?await e.json():await e.text()}getWS(){const{url:t}=this,s=t.href.replace(/^https/,"wss"),n=new WebSocket(s);this.ws=n,this.ws.onopen=console.log("ONLINE"),this.ws.onmessage=t=>e.responseHandler(JSON.parse(t.data))}firstSendWS(t){this.ws.onopen=()=>this.ws.send(JSON.stringify(t))}sendWS(t){this.ws.send(JSON.stringify(t))}static responseHandler(e){if(Object.prototype.hasOwnProperty.call(e,"users"))return t.showUsers(e.users),void t.showMessages(e.messages);e.id?t.deleteUserOffline(e):t.showMessages(e)}}new class{constructor(t){this.element=t,this.request=new e,this.login()}login(){this.element.addEventListener("submit",(t=>this.clickHandler(t)))}clickHandler(t){t.target.classList.contains("popup__form")&&this.checkForm(t)}async checkForm(e){if(e.preventDefault(),![...e.target.elements].find((t=>!t.validity.valid))){const s={nickname:e.target.elements[0].value,password:e.target.elements[1].value},n=await this.request.post(s);"object"==typeof n?(t.showHint(),t.start(e.target.elements[0].value),t.showMessages(n,e.target.elements[0].value)):t.showHint(n)}}}(document)})();